name: Test verify-jvm-project

runs:
  using: composite
  steps:
    - shell: bash
      run: echo "ðŸŽ­Displaying JVM versions..."

    - shell: bash
      run: |
        echo "â˜•Java version: $(java --version | head -n 1)"

        echo "ðŸª¶Maven version: $(mvn --version | head -n 1)"

        echo "ðŸ˜Gradle version: $(gradle --version | grep -P '^Gradle \d+\.\d+(\.\d+)?$' | head -n 1 | cut -d ' ' -f 2)"

    - uses: ./actions/detect-branch-version
      id: version-detector

    - shell: bash
      run: echo "ðŸŽ­Build and verify the Maven project..."

    - uses: ./actions/verify-jvm-project
      with:
        project-directory: tests/maven-project

    - name: Run the Maven-generated jar
      shell: bash
      working-directory: tests/maven-project
      run: |
        version="${{ steps.version-detector.outputs.version }}"

        programOutput="$(java -jar target/maven-project-$version.jar)"

        echo "ðŸ”ŽMaven program output: '$programOutput'"

        if [[ "$programOutput" == "Hello, world - from Kotlin! ðŸ¥³" ]]
        then
          echo "ðŸª¶Maven project verified and run successfully!"
        else
          echo "âŒUnexpected program output!" >&2
          exit 1
        fi

    - shell: bash
      run: echo "ðŸŽ­Build and verify the Gradle project..."

    - name: Build and verify the Gradle project
      uses: ./actions/verify-jvm-project
      with:
        project-directory: tests/gradle-project

    - name: Run the Gradle-generated jar
      shell: bash
      working-directory: tests/gradle-project
      run: |
        version="${{ steps.version-detector.outputs.version }}"

        programOutput="$(java -jar build/libs/gradle-project-$version.jar)"

        echo "ðŸ”ŽGradle program output: '$programOutput'"

        if [[ "$programOutput" == "Hello, world - from Kotlin! ðŸ¥³" ]]
        then
          echo "ðŸ˜Gradle project verified and run successfully!"
        else
          echo "âŒUnexpected program output!" >&2
          exit 1
        fi
